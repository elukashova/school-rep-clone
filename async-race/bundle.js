(()=>{"use strict";class t{constructor(t,e,i,n,a){this.element=document.createElement(t),e&&e.append(this.element),i&&this.element.classList.add(...i.split(" ")),n&&(this.element.textContent=n),a&&Object.entries(a).forEach((([t,e])=>{this.element.setAttribute(t,e)}))}}class e extends t{constructor(t,e){super("header",t,"header"),this.root=t,this.callback=e,this.garageBtn=null,this.winnersBtn=null,this.navBtnCallback=()=>{this.callback()},this.render(),this.disableGarageBtn()}render(){const e=new t("div",this.element,"header__container"),i=new t("a",e.element,"header__logo logo"),n=new t("img",void 0,"logo__img","",{src:"./assets/logo.png"});i.element.append(n.element);const a=new t("nav",e.element,"header__nav nav");this.garageBtn=new t("button",a.element,"nav__garage-btn","garage"),this.garageBtn.element.addEventListener("click",this.navBtnCallback),this.winnersBtn=new t("button",a.element,"nav__winners-btn","winners"),this.winnersBtn.element.addEventListener("click",this.navBtnCallback)}disableGarageBtn(){var t;null===(t=this.garageBtn)||void 0===t||t.element.setAttribute("disabled","")}disableWinnersBtn(){var t;null===(t=this.winnersBtn)||void 0===t||t.element.setAttribute("disabled","")}activateGarageBtn(){var t;null===(t=this.garageBtn)||void 0===t||t.element.removeAttribute("disabled")}activateWinnersBtn(){var t;null===(t=this.winnersBtn)||void 0===t||t.element.removeAttribute("disabled")}}var i,n=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{o(n.next(t))}catch(t){s(t)}}function l(t){try{o(n.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}o((n=n.apply(t,e||[])).next())}))};class a{static load(t,e,i){return n(this,void 0,void 0,(function*(){return fetch(t,{method:e,headers:{"Content-Type":"application/json"},body:i?JSON.stringify(i):void 0}).then((t=>this.errorHandler(t)))}))}static getAndPatchData(t,e,i){return n(this,void 0,void 0,(function*(){const n=a.createURL(e);if(i){const t=a.makeURLParams(i);n.search=new URLSearchParams(t).toString()}return this.load(n,t).then((t=>t.json()))}))}static getData(t,e,i){return n(this,void 0,void 0,(function*(){const n=a.createURL(e);if(i){const t=a.makeURLParams(i);n.search=new URLSearchParams(t).toString()}return this.load(n,t).then((t=>t.json()))}))}static getPageData(t,e,i){return n(this,void 0,void 0,(function*(){const n=a.createURL(e);if(i){const t=a.makeURLParams(i,!0);n.search=new URLSearchParams(t).toString()}return this.load(n,t).then((t=>t.json().then((e=>{const i=t.headers.get("X-Total-Count");return{data:e,total:i?Number(i):0}}))))}))}static postAndPutData(t,e,i){return n(this,void 0,void 0,(function*(){const n=a.createURL(e);return this.load(n,t,i).then((t=>t.json()))}))}static deleteData(t){return n(this,void 0,void 0,(function*(){const e=a.createURL(t);return this.load(e,"DELETE").then((t=>t.json()))}))}static errorHandler(t){if(!t.ok)throw new Error(t.statusText);return t}static makeURLParams(t,e){return Object.keys(t).reduce(((i,n)=>Object.assign(Object.assign({},i),{[e?`_${n}`:n]:t[n].toString()})),{})}}a.server="http://127.0.0.1:3000/",a.createURL=t=>new URL(t,a.server),function(t){t.Error400="Bad Request",t.Error404="Not Found",t.Error429="Too Many Requests",t.Error500="Internal Server Error"}(i||(i={}));const s=new class{constructor(){this.events={},this.on=(t,e)=>{this.events[t]||(this.events[t]=[]),this.events[t].push(e)},this.unsubscribe=(t,e)=>{this.events[t]&&(this.events[t]=this.events[t].filter((t=>t.toString()!==e.toString())))},this.emit=(t,e)=>{const i=this.events[t];i&&i.forEach((t=>{t.call(null,e)}))}}};var r=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{o(n.next(t))}catch(t){s(t)}}function l(t){try{o(n.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}o((n=n.apply(t,e||[])).next())}))};class l{constructor(t,e){this.EngineState={id:void 0,status:"stopped"},this.duration=0,this.isRace=!1,this.startDriving=()=>r(this,void 0,void 0,(function*(){this.setStatusToStarted(),yield l.turnEngineOnOff(this.EngineState).then((t=>this.startCarAnimation(t))).then((()=>this.switchToDrivingMode()))})),this.switchToDrivingMode=()=>r(this,void 0,void 0,(function*(){var t;try{this.EngineState.status="drive",(yield l.startDriveMode(this.EngineState))&&!0===this.isRace&&(s.emit("isWinner",this.EngineState),this.startSnowmanAnimation())}catch(e){e instanceof Error&&e.message===i.Error500&&this.carAnimation&&(null===(t=this.carAnimation)||void 0===t||t.pause(),s.emit("broken",{}))}this.isRace=!1})),this.stopDriving=()=>r(this,void 0,void 0,(function*(){this.setStatusToStopped(),s.emit("stopDriving",this.EngineState),yield l.turnEngineOnOff(this.EngineState),this.stopCarAnimation(),this.setStatusToStarted()})),this.carAnimationCallback=()=>{s.emit("animationFinished",this.EngineState)},this.car=t.car,this.EngineState.id=t.id,this.parent=t.parent,this.finishSVG=e}startCarAnimation(t){this.duration=t.distance/t.velocity,this.carAnimation=this.car.svg.animate([{transform:"translateX(0)"},{transform:`translateX(${this.parent.clientWidth-this.car.svg.clientWidth}px)`}],{duration:this.duration,fill:"forwards"})}startSnowmanAnimation(){this.finishSVGAnimation=this.finishSVG.animate([{transform:"rotate(-15deg)"},{transform:"rotate(15deg)"}],{duration:500,direction:"alternate",iterations:4})}stopCarAnimation(){this.carAnimation&&(this.removeEventListener(),this.carAnimation.cancel())}removeEventListener(){this.carAnimation.removeEventListener("finish",this.carAnimationCallback)}addEventListener(){this.carAnimation.addEventListener("finish",this.carAnimationCallback)}setStatusToStarted(){"started"!==this.EngineState.status&&(this.EngineState.status="started")}setStatusToStopped(){"stopped"!==this.EngineState.status&&(this.EngineState.status="stopped")}}l.turnEngineOnOff=t=>a.getAndPatchData("PATCH","engine",t),l.startDriveMode=t=>a.getAndPatchData("PATCH","engine",t);class o{constructor(){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg")}appendSVG(t){const e=document.createElementNS("http://www.w3.org/2000/svg","use");e.setAttribute("href","assets/sprite.svg#snowmobile"),this.svg.classList.add("race__car"),this.svg.append(e),t.append(this.svg)}updateColor(t){this.svg.setAttribute("fill",`${t}`)}replaceSVG(t,e){const i=document.createElementNS("http://www.w3.org/2000/svg","use");i.setAttribute("href","assets/sprite.svg#snowmobile"),this.svg.classList.add("race__car"),this.svg.append(i),t.replaceChild(this.svg,e)}}const h=t=>a.getAndPatchData("PATCH","engine",t);var c=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{o(n.next(t))}catch(t){s(t)}}function l(t){try{o(n.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}o((n=n.apply(t,e||[])).next())}))};class d extends t{constructor(e){super("div",void 0,"race__track"),this.trackLine=new t("div",void 0,"race__track-line"),this.selectBtn=null,this.deleteBtn=null,this.carNameElement=null,this.startBtn=null,this.stopBtn=null,this.modal=null,this.finishSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.carData={name:"",color:""},this.winner={id:0,wins:0,time:0},this.startBtnCallback=()=>c(this,void 0,void 0,(function*(){s.emit("waitingToStart",{}),this.disableBtnsWhileDriving(),this.activateStopBtn(),yield this.engine.startDriving()})),this.stopBtnCallback=()=>c(this,void 0,void 0,(function*(){this.activateBtnsAfterDriving(),this.disableStopBtn(),yield this.engine.stopDriving()})),this.deleteBtnCallback=()=>c(this,void 0,void 0,(function*(){var t;this.id&&(yield(t=this.id,a.deleteData(`winners/${t}`)).catch((()=>null)),yield d.deleteCar(this.id).then((()=>s.emit("deleteCar",{id:this.id}))))})),this.selectBtnCallback=()=>{this.carData.id=this.id,s.emit("selectCar",this.carData)},this.registerWinner=(t,e)=>c(this,void 0,void 0,(function*(){try{this.winner=yield(t=>a.getAndPatchData("GET",`winners/${t}`))(e);const i=Math.min(Number(t),this.winner.time);yield((t,e)=>a.postAndPutData("PUT",`winners/${e}`,t))({wins:this.winner.wins+1,time:i},e)}catch(n){this.winner.id=e,this.winner.time=Number(t),this.winner.wins=1,yield(i=this.winner,a.postAndPutData("POST","winners",i)),s.emit("isWinner",{})}var i})),this.car=new o,this.EngineData={car:this.car,parent:this.trackLine.element,id:void 0},e.id&&(this.id=e.id,this.EngineData.id=e.id),this.carData.name=e.name,this.carData.color=e.color,this.engine=new l(this.EngineData,this.finishSVG),this.render(),this.subscribeToEvents()}render(){const e=new t("div",this.element,"race__track-left"),i=new t("div",this.element,"race__track-right"),n=new t("div",i.element,"race__track-top"),a=new t("div",i.element,"race__track-bottom"),s=new t("div",e.element,"race__track-bottom__btns"),r=document.createElementNS("http://www.w3.org/2000/svg","use");this.selectBtn=d.createBtn({parent:s,name:"select",type:"submit"}),this.deleteBtn=d.createBtn({parent:s,name:"delete",type:"submit"}),this.carNameElement=new t("span",n.element,"race__car-name",`${this.carData.name}`),this.startBtn=d.createBtn({parent:s,name:"start",type:"submit"}),this.stopBtn=d.createBtn({parent:s,name:"stop",type:"submit"}),r.setAttribute("href","assets/sprite.svg#snowman"),this.finishSVG.classList.add("race__end"),this.stopBtn.element.setAttribute("disabled",""),a.element.append(this.trackLine.element),this.car.appendSVG(this.trackLine.element),this.finishSVG.append(r),this.trackLine.element.append(this.finishSVG),this.car.updateColor(this.carData.color),this.startBtn.element.addEventListener("click",this.startBtnCallback),this.stopBtn.element.addEventListener("click",this.stopBtnCallback),this.deleteBtn.element.addEventListener("click",this.deleteBtnCallback),this.selectBtn.element.addEventListener("click",this.selectBtnCallback)}showWinner(e,i){this.registerWinner(e,i),this.modal=new t("div",this.element,"winner-modal"),this.modal.element.textContent=`${this.carData.name} wins in ${e}s!`}hideModal(){var t;(null===(t=this.modal)||void 0===t?void 0:t.element.parentElement)===this.element&&this.element.removeChild(this.modal.element)}subscribeToEvents(){s.on("updateCar",(t=>{t.id===this.id&&(this.car.updateColor(String(t.color)),this.updateName(String(t.name)))})),s.on("startRace",(()=>{this.disableBtnsWhileDriving(),this.disableStopBtn()})),s.on("stopRacing",(()=>{this.activateBtnsAfterDriving(),this.disableStopBtn()}))}disableBtnsWhileDriving(){var t,e,i;null===(t=this.startBtn)||void 0===t||t.element.setAttribute("disabled",""),null===(e=this.selectBtn)||void 0===e||e.element.setAttribute("disabled",""),null===(i=this.deleteBtn)||void 0===i||i.element.setAttribute("disabled","")}activateBtnsAfterDriving(){var t,e,i;null===(t=this.startBtn)||void 0===t||t.element.removeAttribute("disabled"),null===(e=this.selectBtn)||void 0===e||e.element.removeAttribute("disabled"),null===(i=this.deleteBtn)||void 0===i||i.element.removeAttribute("disabled")}updateName(t){this.carNameElement&&(this.carNameElement.element.textContent=`${t}`)}activateStopBtn(){var t;null===(t=this.stopBtn)||void 0===t||t.element.removeAttribute("disabled")}disableStopBtn(){var t;null===(t=this.stopBtn)||void 0===t||t.element.setAttribute("disabled","")}static createBtn(e){return new t("button",e.parent.element,`race__${e.name}_btn`,`${e.name}`,{type:`${e.type}`})}}d.deleteCar=t=>a.deleteData(`garage/${t}`);const u=["Abarth","Acura","Alfa Romeo","Aston Martin","Audi","Bentley","BMW","Bugatti","Buick","Cadillac","Chevrolet","Chrysler","Citroën","Dacia","Daewoo","Daihatsu","Dodge","Donkervoort","DS","Ferrari","Fiat","Fisker","Ford","Honda","Hummer","Hyundai","Infiniti","Iveco","Jaguar","Jeep","Kia","KTM","Lada","Lamborghini","Lancia","Land Rover","Landwind","Lexus","Linkoln","Lotus","Maserati","Maybach","Mazda","McLaren","Mercedes-Benz","MG","Mini","Mitsubishi","Morgan","Nissan","Opel","Peugeot","Porsche","Renault","Rolls-Royce","Rover","Saab","Seat","Skoda","Smart","SsangYong","Subaru","Suzuki","Tesla","Toyota","Volkswagen","Volvo"],g=["A3","A4","A5","A6","A7","Acadia","Accent","Accord","Air","Altima","Ariya","Armada","Arteon","Ascent","Atlas","Avalon","Aviator","Blazer","Bronco","BRZ","C40","Camaro","Camry","Carnival","Cayenne","Celestiq","Challenger","Charger","Cherokee","Civic","CLA","CLS","Clubman","Compass","Corolla","Corolla","Corvette","CR-V","Crosstrek","Crown","CT4","CT5","Cullinan","CX-3","CX-5","CX-9","Cybertruck","Dawn","DB11","DBS","DBX","Defender","Discovery","Durango","E-Class","EcoSport","Edge","Edge","Enclave","Encore","Envision","Equinox","ES","Escalade","Escape","EV6","EV9","EX90","Explorer","F150","F8","Forester","Forte","G-Class","G70","G80","G90","Ghibli","Ghost","Giulia","GLA","GLB","GLC","GLE","GR86","Grecale","GV60","GV70","GV80","GX","Highlander","Hornet","Huracan","i3","i4","i7","ILX","ILX","Impreza","Insight","Integra","Ioniq","IS","iX","Jetta","K5","Kicks","Kona","LC","LS","LX","M2","M3","M4","M5","M8","Macan","Macan","Maverick","Maxima","MC20","Mirage","Mirai","Murano","Mustang","Nautilus","Navigator","Niro","NSX","NX","Odyssey","Outback","Outlander","Pacifica","Palisade","Panamera","Passat","Pilot","Prius","Q3","Q5","Q50","Q60","Q7","Q8","QX50","QX55","QX60","QX80","R1S","R1T","RC","RDX","Recon","Rio","Rogue","Roma","RX","RZ","S3","S4","S5","S6","S60","S7","S8","S90","Santa Fe","Sedona","Seltos","Sentra","Sequoia","Sienna","Sierra","Solterra","Sonata","Sorento","Soul","Spark","Sportage","SQ5","SQ7","SQ8","Stelvio","Stinger","Tahoe","Taos","Taycan","Terrain","Tiguan","Tonale","Traverse","Trax","Tucson","TX","Urus","V60","V90","Wraith","Wrangler","X1","X2","X3","X4","X5","XF","XM","Yukon","Z4","ZDX"],m=()=>{const t=Math.floor(Math.random()*u.length),e=Math.floor(Math.random()*g.length);return`${u[t]} ${g[e]}`},p=()=>{const t=Math.floor(256*Math.random()).toString(16);return 2!==t.length?`0${t}`:t},v=()=>{let t="#";for(let e=0;e<3;e+=1)t+=p();return t};class w extends t{constructor(t,e,i,n){super("div",t.element,`${e}__pagination pagination`),this.leftArrowBtn=null,this.rightArrowBtn=null,this.currentPageElement=null,this.currentPage=0,this.totalPages=0,this.itemsPerPage=0,this.currentPage=i.page,this.totalPages=n,this.itemsPerPage=i.limit,this.selector=e,this.render(),this.disableArrowsFirstLastPage(this.currentPage)}render(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","use"),a=document.createElementNS("http://www.w3.org/2000/svg","use");this.leftArrowBtn=new t("button",this.element,`${this.selector}__btn-left`),this.currentPageElement=new t("span",this.element,`${this.selector}__current-page`,`${this.currentPage} / ${this.totalPages}`),this.rightArrowBtn=new t("button",this.element,`${this.selector}__btn-right`),this.leftArrowBtn.element.append(e),this.rightArrowBtn.element.append(i),e.append(n),i.append(a),n.setAttribute("href","assets/sprite.svg#left-arrow"),a.setAttribute("href","assets/sprite.svg#right-arrow"),i.classList.add(`${this.selector}__btn-right_svg`),e.classList.add(`${this.selector}__btn-left_svg`)}updateCurrentPage(t){this.currentPage=t,this.updatePages()}updateTotalPages(t){this.totalPages=t,this.updatePages(),this.totalPages!==this.currentPage&&this.activateRightArrowBtn()}updatePages(){this.currentPageElement&&(this.currentPageElement.element.textContent=`${this.currentPage} / ${this.totalPages}`,this.adjustWidth())}adjustWidth(){this.currentPage>=100&&this.totalPages>=100&&this.currentPageElement&&(this.currentPageElement.element.style.width="7.5em")}disableBothButtonsDuringRace(){this.disableLeftArrowBtn(),this.disableRightArrowBtn()}activateBothButtonsAfterRace(){this.activateRightArrowBtn(),this.activateLeftArrowBtn(),this.disableArrowsFirstLastPage(this.currentPage)}disableArrowsFirstLastPage(t){1===t&&this.disableLeftArrowBtn(),t===this.totalPages&&this.disableRightArrowBtn()}activateRightArrowBtn(){var t;(null===(t=this.rightArrowBtn)||void 0===t?void 0:t.element.hasAttribute("disabled"))&&this.rightArrowBtn.element.removeAttribute("disabled")}activateLeftArrowBtn(){var t;(null===(t=this.leftArrowBtn)||void 0===t?void 0:t.element.hasAttribute("disabled"))&&this.leftArrowBtn.element.removeAttribute("disabled")}disableRightArrowBtn(){var t,e;(null===(t=this.rightArrowBtn)||void 0===t?void 0:t.element.hasAttribute("disabled"))||null===(e=this.rightArrowBtn)||void 0===e||e.element.setAttribute("disabled","")}disableLeftArrowBtn(){var t,e;(null===(t=this.leftArrowBtn)||void 0===t?void 0:t.element.hasAttribute("disabled"))||null===(e=this.leftArrowBtn)||void 0===e||e.element.setAttribute("disabled","")}calculateTotalPages(t){return Math.ceil(t/this.itemsPerPage)}}var b=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{o(n.next(t))}catch(t){s(t)}}function l(t){try{o(n.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}o((n=n.apply(t,e||[])).next())}))};class C extends t{constructor(){super("section",void 0,"section garage"),this.createInputText=null,this.createInputColor=null,this.createBtn=null,this.raceBtn=null,this.resetBtn=null,this.generateBtn=null,this.totalCarsElement=null,this.raceFieldWrapper=null,this.raceField=null,this.carData={name:"",color:""},this.currentPageStatus={page:1,limit:7},this.totalPages=1,this.totalCars=0,this.tracksOnPage=[],this.allTracks=[],this.finishCounter=0,this.winnerCounter=0,this.isNewCar=!1,this.isSlideBack=!1,this.isUpdatePage=!1,this.startIdx=0,this.endIdx=0,this.render=()=>b(this,void 0,void 0,(function*(){yield C.getCars(this.currentPageStatus).then((e=>{this.totalCars=e.total,this.renderSettingsBlock(),this.raceFieldWrapper=new t("div",this.element,"garage__race-wrapper"),this.renderRaceBlock(e.data)}))})),this.createTextInputCallback=()=>{this.createInputText&&(this.carData.name=this.createInputText.element.value)},this.createColorInputCallback=()=>{this.createInputColor&&(this.carData.color=this.createInputColor.element.value)},this.createBtnCallback=()=>b(this,void 0,void 0,(function*(){if(this.createInputText&&this.createInputText.element.value){this.createColorInputCallback();const t=yield C.createCar(this.carData);this.isNewCar=!0,this.createRaceTrack(t),this.totalCars+=1,this.totalPages=this.pagination.calculateTotalPages(this.totalCars),this.updateGarageNumber(this.totalCars),this.pagination.updateTotalPages(this.totalPages),this.isNewCar=!1,this.createInputText.element.value="",this.createInputColor&&(this.createInputColor.element.value="#6395BD")}else this.createInputText&&(this.createInputText.element.placeholder="Please insert name"),setTimeout((()=>{this.createInputText&&(this.createInputText.element.placeholder="Enter name here")}),1500)})),this.updateTextInputCallback=()=>{this.updateInputText.element.value||this.disableUpdateElements(),this.carData.name=this.updateInputText.element.value},this.updateColorInputCallback=()=>{this.carData.color=this.updateInputColor.element.value},this.updateBtnCallback=()=>b(this,void 0,void 0,(function*(){this.updateColorInputCallback();const t=yield this.updateCar(this.carData);s.emit("updateCar",t),this.disableUpdateElements(),this.setUpdateElementsToDefault(),this.updateInputText.element.value="",this.updateInputColor&&(this.updateInputColor.element.value="#6395BD")})),this.rightArrowBtnCallback=()=>b(this,void 0,void 0,(function*(){var t;(null===(t=this.raceBtn)||void 0===t?void 0:t.element.hasAttribute("disabled"))&&(this.activateBtnsAfterDriving(),this.activateCreateElements(),this.disableResetBtn(),this.removeWinnerAnnouncement()),this.pagination.activateLeftArrowBtn(),this.currentPageStatus.page+=1,this.pagination.updateCurrentPage(this.currentPageStatus.page),this.deleteAllRaceTracks(),this.createTracksOnNextPrevPage(),this.pagination.disableArrowsFirstLastPage(this.currentPageStatus.page)})),this.leftArrowBtnCallback=()=>b(this,void 0,void 0,(function*(){var t;(null===(t=this.raceBtn)||void 0===t?void 0:t.element.hasAttribute("disabled"))&&(this.activateBtnsAfterDriving(),this.activateCreateElements(),this.disableResetBtn(),this.removeWinnerAnnouncement()),this.currentPageStatus.page===this.totalPages&&this.pagination.activateRightArrowBtn(),this.currentPageStatus.page-=1,this.pagination.updateCurrentPage(this.currentPageStatus.page),this.deleteAllRaceTracks(),this.createTracksOnNextPrevPage(),this.pagination.disableArrowsFirstLastPage(this.currentPageStatus.page)})),this.raceBtnCallback=()=>b(this,void 0,void 0,(function*(){s.on("isWinner",(t=>this.announceWinner(t))),this.tracksOnPage.forEach((t=>t.engine.setStatusToStarted()));const t=this.tracksOnPage.map((t=>b(this,void 0,void 0,(function*(){return h(t.engine.EngineState)})))),e=yield Promise.all(t);for(let t=0;t<e.length;t+=1)this.tracksOnPage[t].engine.isRace=!0,this.tracksOnPage[t].engine.startCarAnimation(e[t]),this.tracksOnPage[t].engine.switchToDrivingMode(),this.tracksOnPage[t].engine.addEventListener();s.emit("startRace",{}),this.disableCreateElements(),this.disableBtnsWhileDriving(),this.pagination.disableBothButtonsDuringRace()})),this.resetBtnCallback=()=>b(this,void 0,void 0,(function*(){yield this.resetGame(),s.emit("stopRacing",{}),this.activateBtnsAfterDriving(),this.activateCreateElements(),this.disableResetBtn()})),this.resetGame=()=>b(this,void 0,void 0,(function*(){this.finishCounter=0,this.tracksOnPage.forEach((t=>t.engine.setStatusToStopped()));const t=this.tracksOnPage.map((t=>b(this,void 0,void 0,(function*(){return h(t.engine.EngineState)})))),e=yield Promise.all(t);for(let t=0;t<e.length;t+=1)this.tracksOnPage[t].engine.stopCarAnimation();this.removeWinnerAnnouncement()})),this.generateBtnCallback=()=>b(this,void 0,void 0,(function*(){this.isNewCar=!0;const t=[];for(let e=0;e<100;e+=1){const e={name:"",color:""};e.name=m(),e.color=v(),t.push(e)}const e=t.map((t=>b(this,void 0,void 0,(function*(){return C.createCar(t)}))));(yield Promise.all(e)).forEach((t=>this.createRaceTrack(t))),this.totalCars+=100,this.totalPages=this.pagination.calculateTotalPages(this.totalCars),this.updateGarageNumber(this.totalCars),this.pagination.updateTotalPages(this.totalPages),this.pagination.activateRightArrowBtn(),this.isNewCar=!1})),this.insertCarNameForChange=t=>{this.updateInputText.element.value=`${t.name}`},this.insertCarColorForChange=t=>{this.updateInputColor.element.value=`${t.color}`},this.updateCar=t=>a.postAndPutData("PUT",`garage/${this.id}`,t),this.createTracksOnNextPrevPage=()=>b(this,void 0,void 0,(function*(){yield C.getCars(this.currentPageStatus).then((t=>{t.data.forEach((t=>{this.createRaceTrack(t)}))}))})),this.recreateRaceTrackAfterDeletion=()=>b(this,void 0,void 0,(function*(){yield C.getCars(this.currentPageStatus).then((t=>{const e=this.currentPageStatus.limit-1;this.createRaceTrack(t.data[e])}))})),this.render(),this.subscribeToEvents()}renderSettingsBlock(){const e=new t("div",this.element,"garage__settings settings"),i=new t("div",e.element,"settings__left"),n=new t("div",i.element,"settings__left_top"),a=new t("div",i.element,"settings__left_bottom"),s=new t("div",e.element,"settings__center"),r=new t("div",e.element,"settings__right"),l=new t("div",s.element,"settings__create-wrapper"),o=new t("div",s.element,"settings__update-wrapper");this.totalCarsElement=new t("span",n.element,"settings__cars-total"),this.generateBtn=C.createSettingsBtn({parent:a,name:"generate",type:"submit"}),this.pagination=new w(a,"settings",this.currentPageStatus,this.totalPages),this.createInputText=C.createSettingsInput({parent:l,name:"create",type:"text"}),this.createInputColor=C.createSettingsInput({parent:l,name:"create",type:"color"}),this.createBtn=C.createSettingsBtn({parent:l,name:"create",type:"submit"}),this.updateInputText=C.createSettingsInput({parent:o,name:"create",type:"text"}),this.updateInputColor=C.createSettingsInput({parent:o,name:"update",type:"color"}),this.updateBtn=C.createSettingsBtn({parent:o,name:"update",type:"submit"}),this.raceBtn=C.createSettingsBtn({parent:r,name:"race",type:"submit"}),this.resetBtn=C.createSettingsBtn({parent:r,name:"reset",type:"reset"}),this.generateBtn.element.textContent="ADD 100",this.createInputColor.element.value="#6395BD",this.updateInputColor.element.value="#6395BD",this.createInputText.element.placeholder="Enter name here",this.createInputText.element.setAttribute("required",""),this.addListenersFirstLoad(),this.disableElementsFirstLoad(),this.totalPages=this.pagination.calculateTotalPages(this.totalCars),this.pagination.updateTotalPages(this.totalPages)}addListenersFirstLoad(){var t,e,i,n,a,s,r,l;null===(t=this.createInputText)||void 0===t||t.element.addEventListener("input",this.createTextInputCallback),null===(e=this.createInputColor)||void 0===e||e.element.addEventListener("input",this.createColorInputCallback),null===(i=this.createBtn)||void 0===i||i.element.addEventListener("click",this.createBtnCallback),null===(n=this.raceBtn)||void 0===n||n.element.addEventListener("click",this.raceBtnCallback),null===(a=this.resetBtn)||void 0===a||a.element.addEventListener("click",this.resetBtnCallback),null===(s=this.generateBtn)||void 0===s||s.element.addEventListener("click",this.generateBtnCallback),null===(r=this.pagination.rightArrowBtn)||void 0===r||r.element.addEventListener("click",this.rightArrowBtnCallback),null===(l=this.pagination.leftArrowBtn)||void 0===l||l.element.addEventListener("click",this.leftArrowBtnCallback)}disableElementsFirstLoad(){this.disableResetBtn(),this.disableUpdateElements()}updateGarageNumber(t){var e;(null===(e=this.totalCarsElement)||void 0===e?void 0:e.element)&&(this.totalCarsElement.element.textContent=`Garage: ${t}`)}static calculateTime(t){return String(Math.ceil(t/1e3*100)/100)}announceWinner(t){s.unsubscribe("isWinner",(t=>this.announceWinner(t)));let e=0,i="";for(let n=0;n<this.tracksOnPage.length;n+=1)Number(this.tracksOnPage[n].element.id)===t.id&&(i=C.calculateTime(this.tracksOnPage[n].engine.duration),e=Number(this.tracksOnPage[n].element.id),this.tracksOnPage[n].showWinner(i,e))}subscribeToEvents(){s.on("selectCar",(t=>{this.activateUpdateElements(),this.insertCarNameForChange(t),this.insertCarColorForChange(t),this.carData.name=String(t.name),this.id=Number(t.id)})),s.on("deleteCar",(t=>{this.totalCars-=1,this.updateGarageNumber(this.totalCars),this.deleteOneRaceTrack(t)})),s.on("waitingToStart",(()=>{this.disableBtnsWhileDriving(),this.disableCreateElements()})),s.on("stopDriving",(()=>{this.activateBtnsAfterDriving(),this.activateCreateElements()})),s.on("broken",(()=>{this.finishCounter+=1,this.finishCounter===this.tracksOnPage.length&&this.isRaceEnd()})),s.on("animationFinished",(()=>{this.finishCounter+=1,this.finishCounter===this.tracksOnPage.length&&this.isRaceEnd()}))}isRaceEnd(){var t;this.tracksOnPage.forEach((t=>{t.engine.removeEventListener()})),this.finishCounter=0,this.activateCreateElements(),null===(t=this.generateBtn)||void 0===t||t.element.removeAttribute("disabled"),this.activateResetBtn(),this.pagination.activateBothButtonsAfterRace()}setUpdateElementsToDefault(){this.updateInputText.element.value="",this.updateInputColor.element.value="#000000"}activateCreateElements(){var t,e,i;null===(t=this.createInputText)||void 0===t||t.element.removeAttribute("disabled"),null===(e=this.createInputColor)||void 0===e||e.element.removeAttribute("disabled"),null===(i=this.createBtn)||void 0===i||i.element.removeAttribute("disabled")}disableCreateElements(){var t,e,i;null===(t=this.createInputText)||void 0===t||t.element.setAttribute("disabled",""),null===(e=this.createInputColor)||void 0===e||e.element.setAttribute("disabled",""),null===(i=this.createBtn)||void 0===i||i.element.setAttribute("disabled","")}activateUpdateElements(){this.updateInputText.element.removeAttribute("disabled"),this.updateInputColor.element.removeAttribute("disabled"),this.updateBtn.element.removeAttribute("disabled"),this.updateInputText.element.addEventListener("input",this.updateTextInputCallback),this.updateInputColor.element.addEventListener("input",this.updateColorInputCallback),this.updateBtn.element.addEventListener("click",this.updateBtnCallback)}disableUpdateElements(){this.updateInputText.element.setAttribute("disabled",""),this.updateInputColor.element.setAttribute("disabled",""),this.updateBtn.element.setAttribute("disabled","")}disableBtnsWhileDriving(){var t,e;null===(t=this.raceBtn)||void 0===t||t.element.setAttribute("disabled",""),null===(e=this.generateBtn)||void 0===e||e.element.setAttribute("disabled","")}activateBtnsAfterDriving(){var t,e;null===(t=this.raceBtn)||void 0===t||t.element.removeAttribute("disabled"),null===(e=this.generateBtn)||void 0===e||e.element.removeAttribute("disabled")}disableResetBtn(){var t;null===(t=this.resetBtn)||void 0===t||t.element.setAttribute("disabled","")}activateResetBtn(){var t;null===(t=this.resetBtn)||void 0===t||t.element.removeAttribute("disabled")}static createSettingsInput(e){return new t("input",e.parent.element,`settings__${e.name}_input-${e.type}`,"",{type:`${e.type}`})}static createSettingsBtn(e){return new t("button",e.parent.element,`settings__${e.name}_btn`,`${e.name}`,{type:`${e.type}`})}renderRaceBlock(e){var i;this.raceField=new t("div",null===(i=this.raceFieldWrapper)||void 0===i?void 0:i.element,"garage__race-field race"),e.forEach((t=>{this.createRaceTrack(t)}))}createRaceTrack(t){var e;const i=new d(t);this.tracksOnPage.length<this.currentPageStatus.limit&&(null===(e=this.raceField)||void 0===e||e.element.append(i.element),this.tracksOnPage.push(i)),i.element.setAttribute("id",`${t.id}`),this.updateGarageNumber(this.totalCars)}deleteOneRaceTrack(t){if(this.raceField){for(let e=0;e<this.raceField.element.children.length;e+=1)Number(this.raceField.element.children[e].id)===t.id&&this.raceField.element.removeChild(this.raceField.element.children[e]);this.updateCurrentTrackArray(String(t.id)),this.currentPageStatus.page!==this.totalPages&&this.recreateRaceTrackAfterDeletion(),this.totalPages=this.pagination.calculateTotalPages(this.totalCars),this.pagination.updateTotalPages(this.totalPages),this.checkIfZero()}}checkIfZero(){0===this.tracksOnPage.length&&(this.currentPageStatus.page-=1,this.pagination.updateCurrentPage(this.currentPageStatus.page),this.createTracksOnNextPrevPage(),this.pagination.disableArrowsFirstLastPage(this.currentPageStatus.page))}updateCurrentTrackArray(t){this.tracksOnPage=this.tracksOnPage.filter((e=>e.element.id!==t))}deleteAllRaceTracks(){if(this.tracksOnPage=[],this.raceField){let t=this.raceField.element.children.length-1;for(;this.raceField.element.children.length>0&&t>=0;)this.raceField.element.removeChild(this.raceField.element.children[t]),t-=1}}removeWinnerAnnouncement(){for(let t=0;t<this.tracksOnPage.length;t+=1)this.tracksOnPage[t].hideModal()}}C.getCars=t=>a.getPageData("GET","garage",t),C.createCar=t=>a.postAndPutData("POST","garage",t);var P=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{o(n.next(t))}catch(t){s(t)}}function l(t){try{o(n.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}o((n=n.apply(t,e||[])).next())}))};class S extends t{constructor(){super("section",void 0,"section winners"),this.totalWinners=0,this.totalWinnersElement=null,this.currentPageStatus={page:1,limit:10,sort:"wins",order:"ASC"},this.totalPages=0,this.winnersResults=null,this.winsTH=null,this.timeTH=null,this.winners=[],this.winnersCars=[],this.color="",this.rows=[],this.winnersInfo={number:0,car:void 0,name:"",wins:0,time:0},this.orderNum=1,this.winnersOnPage=[],this.renderWinnersTable=()=>P(this,void 0,void 0,(function*(){var e,i;const n=new t("div",this.element,"winners__pagination-wrapper");this.winnersResults=document.createElement("table");const a=this.winnersResults.createTHead().insertRow();this.totalWinnersElement=new t("span",n.element,"winners__pagination_total-winners",`Winners: ${this.totalWinners}`),this.pagination=new w(n,"winners",this.currentPageStatus,this.totalPages),this.winnersResults.classList.add("winners__results"),this.element.append(this.winnersResults),this.insertHeading(["n°","car","name","wins","time"],a),null===(e=this.pagination.rightArrowBtn)||void 0===e||e.element.addEventListener("click",this.rightArrowBtnCallback),null===(i=this.pagination.leftArrowBtn)||void 0===i||i.element.addEventListener("click",this.leftArrowBtnCallback)})),this.fillWinnersPage=()=>P(this,void 0,void 0,(function*(){yield this.retrieveData(),this.createRows(),this.updateTotalPagesData(),this.updateTotalWinnersNum()})),this.retrieveData=()=>P(this,void 0,void 0,(function*(){var t;yield(t=this.currentPageStatus,a.getPageData("GET","winners",t)).then((t=>{this.totalWinners=t.total,this.winners=t.data.slice()})),this.winnersCars=(yield Promise.all(this.winners.map((t=>{return e=t.id,a.getAndPatchData("GET",`garage/${e}`);var e})))).slice();for(let t=0;t<this.winners.length;t+=1)this.winnersOnPage.push(Object.assign(Object.assign(Object.assign({},this.winners[t]),this.winnersCars[t]),{car:new o,number:this.orderNum})),this.orderNum+=1})),this.rightArrowBtnCallback=()=>{this.pagination.activateLeftArrowBtn(),this.currentPageStatus.page+=1,this.pagination.updateCurrentPage(this.currentPageStatus.page),this.deleteRows(),this.pagination.disableArrowsFirstLastPage(this.currentPageStatus.page)},this.leftArrowBtnCallback=()=>{this.pagination.activateRightArrowBtn(),this.currentPageStatus.page-=1,this.orderNum-=this.currentPageStatus.limit+this.winnersOnPage.length,this.pagination.updateCurrentPage(this.currentPageStatus.page),this.deleteRows(),this.pagination.disableArrowsFirstLastPage(this.currentPageStatus.page)},this.winsSortCallback=()=>{this.currentPageStatus.sort="wins",this.changeSortingOrder(),this.changeWinsSortingArrow(),this.hideTimeSortingArrow(),this.changeItemsOrder(),this.deleteRows()},this.timeSortCallback=()=>{this.currentPageStatus.sort="time",this.changeSortingOrder(),this.changeTimeSortingArrow(),this.hideWinsSortingArrow(),this.changeItemsOrder(),this.deleteRows()},this.renderWinnersTable(),this.fillWinnersPage(),["updateCar","deleteCar","isWinner"].forEach((t=>{s.on(`${t}`,(()=>{this.updatePageViewState()}))}))}createRows(){this.winnersOnPage.forEach((t=>{this.winnersInfo.wins=t.wins,this.winnersInfo.time=t.time,this.winnersInfo.name=t.name,this.winnersInfo.car=t.car,this.winnersInfo.number=t.number,this.color=t.color,this.insertWinnersInfo(this.winnersInfo)}))}insertHeading(e,i){for(let n=0;n<e.length;n+=1){const a=e[n];let s;switch(a){case"wins":this.winsTH=new t("th",i,`results__table_th-${a} table__th`),this.winsTH.element.classList.add("sortable"),this.winsTH.element.textContent=`${a} ↑`,this.winsTH.element.addEventListener("click",this.winsSortCallback);break;case"time":this.timeTH=new t("th",i,`results__table_th-${a} table__th`),this.timeTH.element.classList.add("sortable"),this.timeTH.element.textContent=`${a} (s)`,this.timeTH.element.addEventListener("click",this.timeSortCallback);break;default:s=new t("th",i,`results__table_th-${a} table__th`),s.element.textContent=a}}}insertWinnersInfo(t){if(this.winnersResults){const e=this.winnersResults.insertRow();Object.values(t).forEach((t=>{const i=e.insertCell();i.classList.add("table__cell"),t instanceof o?(t.appendSVG(i),t.updateColor(this.color)):t!==this.color&&(i.innerText=String(t))}))}}updateTotalPagesData(){this.pagination.itemsPerPage=this.currentPageStatus.limit,this.totalPages=this.pagination.calculateTotalPages(this.totalWinners),this.pagination.updateTotalPages(this.totalPages),this.pagination.disableArrowsFirstLastPage(this.currentPageStatus.page)}updateTotalWinnersNum(){this.totalWinnersElement&&(this.totalWinnersElement.element.textContent=`Winners: ${this.totalWinners}`)}changeSortingOrder(){"ASC"===this.currentPageStatus.order?this.currentPageStatus.order="DESC":"DESC"===this.currentPageStatus.order&&(this.currentPageStatus.order="ASC")}changeItemsOrder(){1===this.currentPageStatus.page?this.orderNum=this.currentPageStatus.page:this.orderNum=this.currentPageStatus.limit*(this.currentPageStatus.page-1)+1}changeWinsSortingArrow(){this.winsTH&&("ASC"===this.currentPageStatus.order?this.winsTH.element.textContent="wins ↑":"DESC"===this.currentPageStatus.order&&(this.winsTH.element.textContent="wins ↓"))}changeTimeSortingArrow(){this.timeTH&&("ASC"===this.currentPageStatus.order?this.timeTH.element.textContent="time (s) ↑":"DESC"===this.currentPageStatus.order&&(this.timeTH.element.textContent="time (s) ↓"))}hideTimeSortingArrow(){"wins"===this.currentPageStatus.sort&&this.timeTH&&(this.timeTH.element.textContent="time (s)")}hideWinsSortingArrow(){"time"===this.currentPageStatus.sort&&this.winsTH&&(this.winsTH.element.textContent="wins")}deleteRows(){if(this.winnersResults){let t=this.winnersResults.rows.length-1;for(;this.winnersResults.rows.length>1&&t>0;)this.winnersResults.deleteRow(t),t-=1}this.winnersOnPage=[],this.fillWinnersPage()}updatePageViewState(){this.changeItemsOrder(),this.deleteRows()}}class f extends t{constructor(){super("footer",void 0,"footer")}}const B=new class{constructor(i){this.root=i,this.garagePage=new C,this.winnersPage=new S,this.footer=new f,this.replaceMain=()=>{this.main&&(this.garagePage&&this.garagePage.element.parentElement===this.main.element?(this.main.element.replaceChild(this.winnersPage.element,this.garagePage.element),this.header.activateGarageBtn(),this.header.disableWinnersBtn()):this.winnersPage&&this.winnersPage.element.parentElement===this.main.element&&(this.main.element.replaceChild(this.garagePage.element,this.winnersPage.element),this.header.disableGarageBtn(),this.header.activateWinnersBtn()))},this.root.classList.add("root"),this.header=new e(this.root,this.replaceMain),this.main=new t("main",this.root,"main")}init(){this.main.element.append(this.garagePage.element),this.root.append(this.footer.element)}}(document.body);window.onload=()=>{B.init()}})();